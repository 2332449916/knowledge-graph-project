<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/vis-network.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/vis-network.min.css" rel="stylesheet">
    <!-- åœ¨<head>æ ‡ç­¾ä¸­å¼•å…¥ vis.js -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†å›¾è°±æŸ¥è¯¢</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
        }


        .sidebar h2 {
        color: #ffffff; /* ä¿®æ”¹æ ‡é¢˜å­—ä½“é¢œè‰²ä¸ºç™½è‰² */
}

        /* å·¦ä¾§ä¾§è¾¹å¯¼èˆªæ æ ·å¼ */
        .sidebar {
            width: 200px;
            background-color: #333;
            color: white;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        .sidebar .menu-item {
            margin: 10px 0;
            padding: 10px;
            cursor: pointer;
            color:#ecf0f1;
            display: flex;
            align-items: center;
        }
        .sidebar .menu-item:hover {
            background-color: #ddd;
            border-radius: 5px;
        }
        .content {
            width: 50%;
            padding: 20px;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
            position: relative;
            overflow: hidden;
        }
        .graph-area {
            width: 100%;
            height: 100%;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 10px;
        }
        .query-area {
            width: 30%;
            padding: 20px;
        }
        .query-area h2 {
            margin: 0 0 10px 0;
        }
        .query-area input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .query-area button {
            padding: 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .query-area button:hover {
            background-color: #2980b9;
        }
        .result {
            margin-top: 20px;
        }
        .result-item {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§èœå•æ  -->
    <div class="sidebar">
        <h2>çŸ¥è¯†å›¾è°±æŸ¥è¯¢</h2>
        <div class="menu-item">ğŸ  é¦–é¡µ</div>
        <div class="menu-item">ğŸ” æŸ¥è¯¢</div>
        <div class="menu-item">ğŸ“š æ•°æ®ç®¡ç†</div>
        <div class="menu-item">âš™ï¸ è®¾ç½®</div>
    </div>

    <!-- ä¸­é—´å›¾è°±å±•ç¤ºåŒº -->
    <div class="content">
        <h2>çŸ¥è¯†å›¾è°±å±•ç¤º</h2>
        <div id="graph" class="graph-area">
            <!-- å›¾è°±å°†åœ¨è¿™é‡Œå±•ç¤º -->
        </div>
    </div>

    <!-- å³ä¾§æŸ¥è¯¢ç»“æœåŒº -->
    <div class="query-area">
        <h2>å®ä½“æŸ¥è¯¢</h2>
        <input type="text" id="entityInput" placeholder="è¯·è¾“å…¥å®ä½“åç§°">
        <button onclick="queryEntity()">æŸ¥è¯¢</button>
      <div class="result" id="queryResult">
    <!-- æŸ¥è¯¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
</div>
<div id="queryGraph" class="graph-area" style="height: 800px; margin-top: 20px;">
    <!-- æŸ¥è¯¢å›¾è°±å°†åœ¨è¿™é‡Œå±•ç¤º -->
</div>

        </div>
    </div>

    <!-- JS è„šæœ¬ -->
    <script>
       document.addEventListener('DOMContentLoaded', loadGraph);

async function loadGraph() {
    try {
        const response = await fetch('http://localhost:3000/graph');
        const data = await response.json();
        
        const nodes = new vis.DataSet(data.nodes.map(node => ({
            id: node.id,
            label: node.label,
            title: node.description || ""  // æ˜¾ç¤ºèŠ‚ç‚¹æè¿°
        })));

        const edges = new vis.DataSet(data.links.map(link => ({
            from: link.source,
            to: link.target,
            label: link.type,
            arrows: 'to'
        })));

        const container = document.getElementById('graph');
        const networkData = { nodes: nodes, edges: edges };
        const options = {
            nodes: {
                shape: 'dot',
                size: 20,
                font: { size: 14 }
            },
            edges: {
                font: { align: 'middle' },
                arrows: 'to'
            },
            physics: {
                stabilization: true  // å›¾è°±ç¨³å®šå¸ƒå±€
            }
        };

        new vis.Network(container, networkData, options);
    } catch (error) {
        console.error('Error loading graph:', error);
        document.getElementById('graph').innerHTML = 'æ— æ³•åŠ è½½å›¾è°±æ•°æ®';
    }
}
// æŸ¥è¯¢å‡½æ•°ä¼˜åŒ–
async function queryEntity() {
  const input = document.getElementById("entityInput").value.trim();
  const resultArea = document.getElementById("queryResult");
  resultArea.innerHTML = "";

  try {
    const response = await fetch('http://localhost:3000/query', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ entity: input })
    });

    if (!response.ok) {
      throw new Error('æœªæ‰¾åˆ°è¯¥å®ä½“ï¼');
    }

    const data = await response.json();
    displayGraph(data.nodes, data.links); // è°ƒç”¨å›¾å½¢åŒ–å‡½æ•°

    // æ˜¾ç¤ºå®ä½“å±æ€§
    resultArea.innerHTML = Object.entries(data.attributes || {}).map(([key, value]) =>
      `<div class='result-item'><strong>${key}ï¼š</strong> ${value}</div>`
    ).join("");
  } catch (error) {
    resultArea.innerHTML = `<div class='result-item'>${error.message}</div>`;
  }
}

// å›¾è°±ç»˜åˆ¶å‡½æ•°ä¼˜åŒ–
function displayGraph(nodesData, linksData) {
  const container = document.getElementById("queryGraph");
  container.innerHTML = "";

  const nodes = new vis.DataSet(nodesData.map(node => ({
    id: node.id,
    label: node.label,
    title: Object.entries(node.properties).map(([key, value]) => `${key}: ${value}`).join("<br>")
  })));

  const edges = new vis.DataSet(linksData.map(link => ({
    from: link.source,
    to: link.target,
    label: link.type,
    arrows: 'to'
  })));

  new vis.Network(container, { nodes, edges }, { physics: { stabilization: true } });
}


        // ä½¿ç”¨ç®€å•å›¾å½¢åŒ–å±•ç¤º
function displayGraph(entity, relations) {
    const container = document.getElementById("queryGraph");''
    container.innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„å›¾è°±

    // æ£€æŸ¥ relations æ˜¯å¦ä¸ºç©º
    if (relations.length === 0) {
        container.innerHTML = "<div style='text-align: center;'>æ— å…³è”æ•°æ®å¯æ˜¾ç¤º</div>";
        return;
    }

    // æ„å»ºèŠ‚ç‚¹å’Œè¾¹æ•°æ®
    const nodes = new vis.DataSet([
        { id: 1, label: entity, color: '#3498db' }  // æŸ¥è¯¢çš„ä¸­å¿ƒèŠ‚ç‚¹
    ]);

    const edges = [];

    relations.forEach((rel, index) => {
        const nodeId = index + 2;  // ä»2å¼€å§‹ï¼Œé¿å…ä¸ä¸­å¿ƒèŠ‚ç‚¹å†²çª
        nodes.add({ id: nodeId, label: rel.connectedEntity, color: '#2ecc71' });
        edges.push({ from: 1, to: nodeId, label: rel.relation, arrows: 'to' });
    });

    const graphData = {
        nodes: nodes,
        edges: new vis.DataSet(edges)
    };

    const options = {
        nodes: {
            shape: 'dot',
            size: 20,
            font: { size: 14 }
        },
        edges: {
            font: { align: 'middle' },
            arrows: 'to'
        },
        physics: {
            stabilization: true  // å›¾è°±ç¨³å®šå¸ƒå±€
        }
    };
    

    new vis.Network(container, graphData, options);
}

    </script>
</body>
</html>



